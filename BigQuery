1. --  To join with numeric key from alpha numeric keyword with one column alphnumeric separted by a delimiter in one col while other numeric column in other table-

SELECT 
    CONCAT(p.firstname, ' ', p.LastName) AS Provider_Name,
    d.Name AS Dept_Name,
    SUM(t.Amount) AS Amount
FROM `avd-databricks-demo.silver_dataset.transactions` t
LEFT JOIN `avd-databricks-demo.silver_dataset.providers` p 
    ON SPLIT(p.ProviderID, "-")[SAFE_OFFSET(1)] = t.ProviderID
LEFT JOIN `avd-databricks-demo.silver_dataset.departments` d 
    ON SPLIT(d.Dept_Id, "-")[SAFE_OFFSET(0)] = p.DeptID
WHERE t.is_quarantined = FALSE AND d.Name IS NOT NULL
GROUP BY Provider_Name, Dept_Name;


üîç What is SPLIT() in BigQuery?
In BigQuery SQL, SPLIT(string, delimiter) splits a string into an array using the specified delimiter.
üîç What is SAFE_OFFSET(n)?
When you access an array element using [n], it can throw an error if the index is out of bounds.
SAFE_OFFSET(n) is a safer way to access the nth element ‚Äî it returns NULL instead of an error if the index doesn't exist.

‚úÖ Putting it Together in Your Query
1. SPLIT(p.ProviderID, "-")[SAFE_OFFSET(1)] = t.ProviderID
p.ProviderID might look like "abc-123" or "prov-456".
SPLIT(p.ProviderID, "-") ‚Üí ['abc', '123']
SAFE_OFFSET(1) ‚Üí gets the second element ('123')
So you're joining the providers table to transactions where the second part of ProviderID in providers matches the ProviderID in transactions.

2. SPLIT(d.Dept_Id, "-")[SAFE_OFFSET(0)] = p.DeptID
d.Dept_Id might look like "D001-Cardiology"
SPLIT(d.Dept_Id, "-") ‚Üí ['D001', 'Cardiology']
SAFE_OFFSET(0) ‚Üí gets the first element ('D001')


-- 2. 
